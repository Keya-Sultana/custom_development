<?xml version="1.0" encoding="UTF-8"?>

<odoo>
	<data>

        <!-- Inherit HR Employee Form View -->

        <record id="hr_employee_offence_view_form" model="ir.ui.view">
        <field name="name">employees offence</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <notebook position="inside">
                <page string="Offence" groups="base.group_user">
                    <group string="Employee Offence">
                    <field name="offence_ids" nolabel="1">
                        <tree string="Training">
                            <field name="offence_type"/>
                            <field name="offence_date"/>
                            <field name="penalty_amount"/>
                        </tree>
                    </field>
                    </group>
                </page>
            </notebook>
        </field>
    </record>

        <!-- Employee Offence Tree View  -->

    <record model="ir.ui.view" id="employee_offence_view">
        <field name="name">Employee Offence</field>
        <field name="model">hr.employee.offence</field>
        <field name="type">tree</field>
        <field name="arch" type="xml">
           <tree decoration-info="state == 'draft'" colors="purple:state == 'confirm';brown:state == 'valid';green:state == 'feedback';red:state == 'cancel';">
               <field name="name"/>
               <field name="employee_id"/>
              <field name="offence_type"/>
              <field name="offence_date"/>
              <field name="state"/>
           </tree>
        </field>
    </record>

        <!-- Sequence-->

        <record id="offence_seq" model="ir.sequence">
            <field name="name">Offence</field>
            <field name="code">hr.employee.offence</field>
            <field name="prefix">EO</field>
            <field eval="4" name="padding" />
        </record>

    <!-- Employee Offence Form View -->

    <record id="employee_offence_form" model="ir.ui.view">
            <field name="name">Employee Offence</field>
            <field name="model">hr.employee.offence</field>
            <field name="arch" type="xml">
                <form string=" Employee Offence ">
                  <header>
             <!--           <button name="action_send_amc" string="Send by Email"
                              type="object" states="draft" class="oe_highlight"/>   -->
                      <button name="action_confirm" type="object" states="draft"
                            string="Confirm" class="oe_highlight"/>
                      <button name="generate_schedules" states="confirm"
                                string="Compute" type="object" class="oe_highlight" groups="hr.group_hr_manager,hr.group_hr_user"/>
                      <button name="action_valid" type="object" states="confirm"
                            string="Validate" class="oe_highlight" groups="hr.group_hr_manager"/>
                      <button name="%(hr_offence_wizard_action_view)d" type="action" string="Reschedule"
                                 context="{'remaining_amount': remaining_offence_amount}" states="valid,feedback" class="oe_highlight"/>
                      <button name="action_feedback" type="object" states="valid"
                            string="Feedback" class="oe_highlight"/>
                      <button name="action_done" type="object" states="feedback"
                            string="Done" class="oe_highlight"/>
                      <button name="action_cancel" type="object" states="confirm,valid"
                            string="Cancel" class="oe_highlight"/>
                      <field name="state" widget="statusbar"/>
				  </header>
                  <sheet>
                      <div>
                          <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                      </div>
                      <group>
                          <group>
                              <field name="employee_id" options="{'no_open': True, 'no_create': True}"
                                     attrs="{'readonly': [('state','not in',('draft'))]}"/>
                              <field name="offence_type" options="{'no_open': True, 'no_create': True}"
                                     attrs="{'readonly': [('state','not in',('draft'))]}"/>
                              <field name="recorded_by" options="{'no_open': True, 'no_create': True}"
                                     attrs="{'readonly': [('state','not in',('draft'))]}"/>
                              <field name="offence_category" options="{'no_open': True, 'no_create': True}"
                                     attrs="{'readonly': [('state','not in',('draft'))]}"/>
                          </group>
                          <group>
                              <field name="offence_date" attrs="{'readonly': [('state','not in',('draft'))]}"/>
                              <field name="damaged_amount" attrs="{'readonly': [('state','not in',('draft'))]}"/>
                              <field name="penalty_amount" attrs="{'readonly': [('state','not in',('confirm'))]}"/>
                              <field name="remaining_offence_amount"/>
                          </group>
                      </group>
                      <group>
                          <field name="description" attrs="{'readonly': [('state','not in',('draft'))]}"/>
                      </group>
                      <group>
                          <field name="replies" attrs="{'readonly': [('state','in',('draft','confirm','valid','done'))]}"/>
                      </group>
                      <notebook position="inside">
                            <page string="General">
                                <group>
                                    <group>
                                        <field name="installment_amount"/>
                                    </group>
                                    <group>
                                        <field name="repayment_date"/>
                                    </group>
                                    <field name="line_ids" readonly="1">
                                        <tree string="List" editable="bottom">
                                            <field name="employee_id" invisible="1"/>
                                            <field name="emp_offence" invisible="1"/>
                                            <field name="num_installment" style="text-align: center;"/>
                                            <field name="schedule_date"/>
                                            <field name="installment"/>
                                            <field name="state"/>
                                        </tree>
                                    </field>
                                </group>
                            </page>
                        </notebook>
                  </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- Employee search view -->

        <record id="view_offence_search" model="ir.ui.view">
            <field name="name">hr.employee.offence.search</field>
            <field name="model">hr.employee.offence</field>
            <field name="arch" type="xml">
                <search string="Search Employee Offence">
                    <field name="name"/>
                    <field name="employee_id"/>
                    <field name="offence_type"/>
                    <field name="offence_date"/>
                    <field name="state"/>
                    <separator/>
                    <group expand="0" string="Group By">
                        <filter string="Status" domain="[]" context="{'group_by':'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <!-- Employee Offenc Action -->

        <record model="ir.actions.act_window" id="act_employee_offence_view">
            <field name="name">Employee Offence</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">hr.employee.offence</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="view_offence_search"/>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Click to Create a New Record.
                </p>
            </field>
        </record>



        <!-- Employee Offence Menu -->

        <menuitem
            action="act_employee_offence_view"
            id="menu_employee_offence_tree"
            parent="hr.menu_hr_root"
            sequence="40"
            groups="hr.group_hr_user,gbs_application_group.group_dept_manager"/>

        <!-- Invisible menu for Payroll -->

        <record id="make_invisible_payroll" model="res.groups">
			<field name="name">Invisible menu for Payroll</field>
		</record>

        <record id="hr_payroll.menu_department_tree" model="ir.ui.menu">
			<field name="groups_id" eval="[(6,0,[ref('hr_employee_offence.make_invisible_payroll')])]" />
		</record>
		
	</data>
</odoo>